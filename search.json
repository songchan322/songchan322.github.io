[{"title":"Tasmota快速入门","path":"/posts/7c39d896ff22/","content":"Tasmota是什么Tasmota 是由 Theo Arends 创建和维护的基于乐鑫ESP8266、ESP32芯片组的设备的GPL-3.0开源固件。最初是为了破解Sonoff Basic使其能够实现本地控制，现已发展成为几乎所有基于 ESP系列芯片 的设备的成熟生态系统。 Tasmota能做什么通过简单的配置，即可实现： 连接传感器、执行器 通过MQTT、Web UI、HTTP、串口读取状态或控制设备 使用内建定时器、规则、脚本功能实现本地自动化 快速上手下面以ESP8266网络继电器模块和AM2302温湿度传感器为例，一步一步演示如何快速上手Tasmota，实现一个带温湿度检测的网络开关。 步骤1：下载固件 从Github发布页下载，这里下载名称为tasmota-sensors.bin的固件，因为后续会集成温湿度传感器。如果只需要实现比方说智能插座类似的功能，基础版本tasmota-CN.bin可能更适合你，官方自带中文。如果有更多个性化需求，也可以选择自行编译固件。 步骤2：烧录固件 使用杜邦线短接GPIO0和GND引脚，使ESP8266上电时启动为烧录模式；连接USB-TTL转换器与模块串口，如下图。 以管理员权限运行ESP_Flasher.exe软件，选择USB-TTL对应的COM口，载入步骤1下载的固件，点击Flash ESP按钮，此时Console窗口内应该有日志输出，直到显示Done！Flashing is complete！，如下图，代表已经烧录成功。 步骤3：配置网络 移除GPIO0和GND引脚之间的短接线，重新上电。如下图，Tasmota会生成一个名称为tasmota-xxxxxx-xxxx的热点，手机连上该热点后，访问192.168.4.1（有些手机会自动跳转），选择你家WIFI的SSID，并在Wifi parameters卡片内输入WiFi密码，点击Save保存。稍等片刻，跳转页面提示Successful WiFi Connection，并在下方显示该设备获取的IP地址，我这里是192.168.88.28。手机切换回原WiFi，访问设备IP即可进入设备配置页面。 步骤4：配置外设 Web UI页面点击Configuration→Configure Module→Module type下拉框，选择Generic(18)，点击Save保存，设备会自动重启； 再次点击Configuration→Configure Module→GPIO4下拉框、GPIO13下拉框，选择Relay，并选择序号，GPIO5下拉框选择AM2301，如下图，点击Save保存，设备重启进入Web UI页面，此时可以看到已经有温湿度数据，下方也多了2个开关，点击开关按钮可以打开或关闭继电器。 步骤5：MQTT Web UI页面点击Configuration→Configure MQTT，填入MQTT服务器的地址、用户名、密码，点击Save保存。 Web UI页面点击Information查看MQTT相关信息，这里的MQTT Full Topic：cmnd/tasmota_835163/为指令接收的主题前缀；点击Console查看日志，可以看到数据上报的主题是tele/tasmota_835163/SENSOR。 下面来试一下使用MQTT客户端控制继电器开关，向cmnd/tasmota_835163/POWER1主题发送(Plaintext)数据1 或 ON，即可接通继电器，发送0 或 OFF即可断开继电器；向cmnd/tasmota_835163/TelePeriod主题发送数据30，可以将数据上报间隔设置为30秒；订阅tele/tasmota_835163/SENSOR主题可以接受设备上报的温湿度数据。 步骤6：基于规则(Rules)实现简易温控 Tasmota的规则(Rules)基于触发器执行操作，常见的触发器有开关状态更改、温度阈值、系统启动等事件、定义的计时器结束、自定义的事件等，操作可以是开关设备、发布消息等任何内建命令。下面我们来试着搭建一个简易温控器。 Text123Rule1 ON AM2301#Temperature&lt;20 DO POWER1 ON ENDON ON AM2301#Temperature&gt;22 DO POWER1 OFF ENDON 在Web UI的Console页面，在command输入框中直接粘贴上面的代码并回车，日志显示17:26:07.045 MQT: stat/tasmota_835163/RESULT = &#123;&quot;Rule1&quot;:&#123;&quot;State&quot;:&quot;OFF&quot;,&quot;Once&quot;:&quot;OFF&quot;,&quot;StopOnError&quot;:&quot;OFF&quot;,&quot;Length&quot;:92,&quot;Free&quot;:419,&quot;Rules&quot;:&quot;ON AM2301#Temperature&lt;20 DO POWER1 ON ENDON ON AM2301#Temperature&gt;22 DO POWER1 OFF ENDON&quot;&#125;&#125;表明规则已经保存到设备，此时这条规则还没有生效，需要输入Rule1 1使其生效，运行效果如下图。","tags":["ESP8266","ESP32","Tasmota"],"categories":["IOT"]},{"title":"给植物安个新家·栏杆防腐木花架","path":"/posts/455a36ae9c44/","content":"前言《舌尖上的中国》中，导演胡博曾说过：中国人走到哪里，都得想办法种点菜。年纪轻轻就住上楼房的我显然没有土地可以种菜，因此，装修时坚决没有封闭阳台，幻想着在阳台打造植物乐园。然而不出意外，意外总会出现，开发商送的凹阳台采光不好，放在阳台的植物长着长就“偏分”了，为了解决采光问题，我计划把植物搬到栏杆外。 方案 花架主体材料采用防腐木，主要考虑家庭条件下制作的难度，同时成本低，美观度也还不错。为了便于表述，这里强行把主体分为2个部分，分别命名为托盘和护栏，对应图中红色和蓝色部分。 考虑到安全问题，花架主体与栏杆连接的部分考虑采用铁艺支架，采取悬挂的方式固定在原铁艺栏杆上。花架下方就是邻居家的玻璃雨棚，为了和谐的邻里关系，还需要考虑有组织排水，办法是在花架底部铺设防水膜，然后通过排水口将水引至排水沟。 材料 85x15x220 防腐木 16根 85x15x2700 防腐木 3根 85x15x2670 防腐木 2根 50x10x2670 防腐木 1根 定制铁艺支架 4个 防水薄膜1卷 约500x3000 25mmPVC鱼缸排水口 1个 25mmPVC管 若干 万能胶 1罐 M3x25沉头自攻螺钉 若干 M3x45沉头自攻螺钉 若干 门形钉 若干 软木片 若干 工具 锂电钻 打钉枪 铅笔 卷尺 25mm开孔器 装配 积木都玩过吧，主体装配的原理和搭积木差不多，木板叠放在一起，用螺丝钉固定即可。装配时，先装配托盘，再装配托盘，结构非常简单，具体过程就不赘述。 主体装配完毕后在托盘的合适位置使用25mm开孔器开一个排水孔。 铺设防水薄膜，铺设的时候将多余的薄膜向内翻折，用门形钉将其固定在托盘内壁上，这样固定更加美观和牢固。 至此，花架主体部分装配完毕，接下去便可以安装到栏杆上。 将铁艺支架放置在栏杆上，将花架主体放在支架上并调整好位置，使用螺钉连接花架主体与支架，这时，花架应该已经稳稳地挂在栏杆上了。 将PVC鱼缸排水口安装到之前开设的排水孔，布置PVC管，使废水能够排到排水沟里。使用软木垫调节支架高度，使水能够顺畅地从排水口流走。 不足 防水薄膜受热会形变，局部会积水。 为了省钱，设计时省去了靠近栏杆一侧的护栏，美观度和强度有一定影响。","tags":["DIY","木工"],"categories":["DIY"]}]